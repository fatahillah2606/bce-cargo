{% extends 'admin/base.html' %}

<!-- Title -->
{% block title %}Pesanan masuk{% endblock %}

<!-- Style -->
{% block style %} {% endblock %}

<!-- Judul header -->
{% block judul %}Pesanan masuk{% endblock %}
<!-- Konten -->
{% block konten %}
<div class="sm:p-4">
    <!-- Container utama -->
    <div class="bg-white dark:bg-zinc-800 sm:rounded-xl shadow p-4">
        <!-- Navigasi Tab -->
        <div class="mb-6 border-b border-zinc-200 dark:border-zinc-700">
            <div class="flex gap-2 text-sm font-medium text-zinc-500">
                <a
                    href="/admin/pesanan_masuk"
                    class="relative px-4 py-2 text-green-600 dark:text-green-400 font-semibold after:absolute after:bottom-0 after:left-0 after:h-0.5 after:w-full after:bg-green-500 dark:after:bg-green-400"
                >
                    Pesanan Masuk
                </a>
                <a
                    href="/admin/riwayat_pesanan"
                    class="px-4 py-2 hover:text-green-600 dark:hover:text-green-400 transition"
                >
                    Riwayat Pesanan
                </a>
                <a
                    href="/admin/status"
                    class="px-4 py-2 hover:text-green-600 dark:hover:text-green-400 transition"
                >
                    Status Pengiriman
                </a>
            </div>
        </div>

        <!-- List Pesanan Masuk -->
        <div class="space-y-4" id="pesanan-masuk">
            {% for i in range(10) %}
            <div
                class="flex items-start gap-4 bg-zinc-50 dark:bg-zinc-700 border border-zinc-200 dark:border-zinc-800 shadow-sm rounded-lg p-4 animate-pulse"
            >
                <div
                    class="w-6 h-6 bg-zinc-200 rounded-lg dark:bg-zinc-800"
                ></div>
                <div class="flex-1">
                    <div class="mb-1 flex flex-wrap gap-1">
                        <div
                            class="h-5 bg-zinc-200 rounded w-32 dark:bg-zinc-900"
                        ></div>
                        <div
                            class="h-5 bg-zinc-300 rounded w-52 dark:bg-zinc-800"
                        ></div>
                        <div
                            class="h-5 bg-zinc-200 rounded w-24 dark:bg-zinc-900"
                        ></div>
                    </div>
                    <div class="flex flex-wrap gap-1">
                        <div
                            class="h-3 bg-zinc-200 rounded w-20 dark:bg-zinc-800"
                        ></div>
                        <div
                            class="h-3 bg-zinc-300 rounded w-40 dark:bg-zinc-900"
                        ></div>
                        <div
                            class="h-3 bg-zinc-200 rounded w-14 dark:bg-zinc-800"
                        ></div>
                        <div
                            class="h-3 bg-zinc-300 rounded w-32 dark:bg-zinc-900"
                        ></div>
                    </div>
                </div>
                <div>
                    <div
                        class="h-8 bg-zinc-200 rounded-lg w-14 dark:bg-zinc-800"
                    ></div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Modal -->
<!-- Overlay + Modal Wrapper -->
<div
    id="modalPesanan"
    class="fixed inset-0 z-50 hidden items-center justify-center bg-black/50"
>
    <div class="bg-white w-full max-w-md rounded-xl shadow-lg p-6 relative">
        <!-- Judul -->
        <h3 class="text-lg font-semibold text-zinc-800 mb-4">
            Detail Pesanan - <span id="modalKode">BCE-U-240626-001</span>
        </h3>

        <!-- Isi Konten -->
        <div class="space-y-2 text-sm text-zinc-700">
            <p>
                <strong>Nama Pelanggan:</strong>
                <span id="modalNama">Fajar Prasetyo</span>
            </p>
            <p>
                <strong>Layanan:</strong>
                <span id="modalLayanan">Kargo Darat</span>
            </p>
            <p><strong>Asal:</strong> <span id="modalAsal">Jakarta</span></p>
            <p>
                <strong>Tujuan:</strong> <span id="modalTujuan">Surabaya</span>
            </p>
            <p>
                <strong>Tanggal:</strong>
                <span id="modalTanggal">22 Juli 2025</span>
            </p>

            <!-- Input Nominal -->
            <div class="mt-4">
                <label
                    for="nominalInput"
                    class="block text-sm font-medium text-zinc-600 mb-1"
                    >Nominal Harga (Rp)</label
                >
                <input
                    type="number"
                    id="nominalInput"
                    class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                    placeholder="Contoh: 150000"
                />
            </div>
        </div>

        <!-- Tombol Aksi -->
        <div class="mt-6 flex justify-end gap-2">
            <button
                onclick="terimaPesanan()"
                id="btnTerima"
                class="bg-green-500 text-white px-4 py-2 rounded-lg disabled:opacity-50"
                disabled
            >
                Terima
            </button>
            <button
                onclick="tolakPesanan()"
                class="bg-red-500 text-white px-4 py-2 rounded-lg"
            >
                Tolak
            </button>
            <button
                onclick="tutupModal()"
                class="bg-zinc-300 text-zinc-800 px-4 py-2 rounded-lg"
            >
                Tutup
            </button>
        </div>
    </div>
</div>

{% endblock %}
<!-- Js per halaman -->
{% block kontenjs %}
<script>
    // Variabel
    const pesananMasukContainer = document.getElementById("pesanan-masuk");
    let listPesanan = "";

    // Request data pesanan masuk
    function muatDataPesananMasuk() {
        // Fetch
        fetch("/admin/api/data/pesanan?status=Pending", {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            },
        })
            .then(async (respon) => {
                const data = await respon.json();
                if (!respon.ok) {
                    throw new Error(data.message);
                }
                return data;
            })
            .then((data) => {
                const dataPesanan = data.data;

                if (dataPesanan.length === 0) {
                    // Jika tidak ada pesanan masuk
                    pesananMasukContainer.innerHTML = `
                            <p
                                class="text-center font-bold text-zinc-600"
                                id="info-pesanan-masuk"
                            >
                                Tidak ada pesanan masuk
                            </p>
                        `;
                } else {
                    dataPesanan.forEach((pesananMasuk) => {
                        let tanggalPemesanan = formatTanggalGMT7(
                            pesananMasuk.tanggal_pemesanan
                        );
                        listPesanan += `
                            <div
                                class="flex items-start gap-4 bg-zinc-50 dark:bg-zinc-700 border border-zinc-200 dark:border-zinc-800 shadow-sm rounded-lg p-4"
                            >
                                <span class="material-symbols-rounded text-green-600 dark:text-green-400 text-3xl"
                                    >local_shipping</span
                                >
                                <div class="flex-1">
                                    <p class="text-sm text-zinc-700 dark:text-zinc-300 mb-1">
                                        <span class="font-semibold text-zinc-900 dark:text-zinc-100"
                                            >${pesananMasuk.kode_pemesanan}</span
                                        >
                                        dari
                                        <span class="font-medium">${pesananMasuk.nama_pengirim}</span> meminta
                                        pengiriman <span class="italic">Kargo ${pesananMasuk.jenis_kargo}</span>.
                                    </p>
                                    <p class="text-xs text-zinc-500 dark:text-zinc-400">
                                        ${pesananMasuk.alamat_pengirim} Â· ${tanggalPemesanan.tanggal}
                                    </p>
                                </div>
                                <div>
                                    <a
                                        href="/admin/detail_pesanan/${pesananMasuk.kode_pemesanan}"
                                        class="text-sm px-3 py-1.5 bg-green-500 text-white rounded-lg hover:bg-green-600 transition"
                                    >
                                        Lihat
                                    </a>
                                </div>
                            </div>
                        `;
                    });

                    pesananMasukContainer.innerHTML = listPesanan;
                }
            })
            .catch((error) => {
                tampilkanAlertKesalahan("An error occurred", error);
                console.error(error);
            });
    }

    // Muat data pesanan masuk
    muatDataPesananMasuk();
</script>
{% endblock %}
