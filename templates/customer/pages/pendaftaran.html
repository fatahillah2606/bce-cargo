<!DOCTYPE html>
<html lang="id">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Pendaftaran | BCE</title>
        <link
            href="{{url_for('static',filename='dist/output.css')}}"
            rel="stylesheet"
        />
        <!-- Local CSS -->
        <link
            rel="stylesheet"
            href="{{url_for('static',filename='css/customer/style.css')}}"
        />
        <!-- Google icon -->
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
        />
        <!-- Font Awesome -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css"
            integrity="sha512-DxV+EoADOkOygM4IR9yXP8Sb2qwgidEmeqAEmDKIOfPRQZOWbXCzLC6vjbZyy0vPisbH2SyW27+ddLVCN+OMzQ=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        />
        <style>
            section {
                min-height: auto;
            }
            /* Zoom in & out sedang */
            @keyframes zoomPulse {
                0%,
                100% {
                    transform: scale(0.95);
                    opacity: 0.95;
                }
                50% {
                    transform: scale(1.05);
                    opacity: 1;
                }
            }
            .animate-zoom-pulse {
                animation: zoomPulse 2.5s ease-in-out infinite;
            }

            /* Glow neon menyatu logo */
            .logo-glow {
                filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.7))
                    drop-shadow(0 0 20px rgba(255, 255, 255, 0.6))
                    drop-shadow(0 0 40px rgba(144, 238, 144, 0.6));
                animation: glowPulse 1s ease-in-out infinite;
            }

            @keyframes glowPulse {
                0%,
                100% {
                    filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.7))
                        drop-shadow(0 0 16px rgba(255, 255, 255, 0.5))
                        drop-shadow(0 0 32px rgba(144, 238, 144, 0.5));
                }
                50% {
                    filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.9))
                        drop-shadow(0 0 30px rgba(255, 255, 255, 0.8))
                        drop-shadow(0 0 60px rgba(144, 238, 144, 0.7));
                }
            }
        </style>
    </head>
    <body class="bg-white font-sans">
        <!-- Navbar -->
        {% include 'customer/components/navbar.html' %}

        <!-- floating -->
        {% include 'customer/components/floating-sidebar.html' %}

        <section class="max-w-5xl mx-auto py-12 px-6" id="bagian-buku-alamat">
            <div
                class="max-w-3xl mx-auto bg-gradient-to-br from-green-50 to-white rounded-2xl shadow-lg p-8 border border-green-100"
            >
                <h2
                    class="text-2xl font-extrabold text-green-800 flex items-center gap-2 mb-8"
                >
                    <span class="material-symbols-rounded text-green-600"
                        >badge</span
                    >
                    Biodata Diri
                </h2>
                <!-- Formulir Biodata -->
                <form method="post" id="form-biodata" class="space-y-6">
                    <!-- Nama -->
                    <div class="relative">
                        <label
                            for="nama"
                            class="block text-sm font-medium text-gray-700"
                            >Nama Lengkap</label
                        >
                        <div class="mt-1 relative">
                            <input
                                type="text"
                                id="nama"
                                name="nama"
                                maxlength="100"
                                value="{{ nama_pengguna }}"
                                required
                                class="peer block w-full rounded-lg border border-gray-300 pl-10 pr-3 py-2 text-sm text-gray-900 focus:border-green-500 focus:ring-green-500 transition"
                            />
                            <span
                                class="material-symbols-rounded absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
                                >person</span
                            >
                        </div>
                        <p
                            class="mt-2 text-sm text-red-600 dark:text-red-500 hidden err-msg"
                        >
                            Pesan error
                        </p>
                    </div>
                    <!-- Nomor Ponsel -->
                    <div class="relative">
                        <label
                            for="ponsel"
                            class="block text-sm font-medium text-gray-700"
                            >Nomor Ponsel</label
                        >
                        <div class="mt-1 relative">
                            <input
                                type="tel"
                                id="ponsel"
                                name="ponsel"
                                minlength="10"
                                maxlength="13"
                                pattern="[0-9]+"
                                required
                                class="peer block w-full rounded-lg border border-gray-300 pl-10 pr-3 py-2 text-sm text-gray-900 focus:border-green-500 focus:ring-green-500 transition"
                            />
                            <span
                                class="material-symbols-rounded absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
                                >phone</span
                            >
                        </div>
                        <p
                            class="mt-2 text-sm text-red-600 dark:text-red-500 hidden err-msg"
                        >
                            Pesan error
                        </p>
                    </div>
                    <!-- Jenis Pelanggan + Perusahaan -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="relative">
                            <label
                                for="jenis"
                                class="block text-sm font-medium text-gray-700"
                                >Jenis Pelanggan</label
                            >
                            <div class="mt-1 relative">
                                <select
                                    id="jenis"
                                    name="jenis"
                                    required
                                    class="peer block w-full rounded-lg border border-gray-300 text-gray-900 pl-10 pr-3 py-2 text-sm focus:border-green-500 focus:ring-green-500 transition cursor-pointer"
                                >
                                    <option value="">Pilih jenis</option>
                                    <option value="perorangan">
                                        Perorangan
                                    </option>
                                    <option value="perusahaan">
                                        Perusahaan
                                    </option>
                                </select>
                                <span
                                    class="material-symbols-rounded absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
                                    >group</span
                                >
                            </div>
                            <p
                                class="mt-2 text-sm text-red-600 dark:text-red-500 hidden err-msg"
                            >
                                Pesan error
                            </p>
                        </div>
                        <div id="field-perusahaan" class="hidden relative">
                            <label
                                for="perusahaan"
                                class="block text-sm font-medium text-gray-700"
                                >Nama Perusahaan</label
                            >
                            <div class="mt-1 relative">
                                <input
                                    type="text"
                                    id="perusahaan"
                                    name="perusahaan"
                                    maxlength="100"
                                    class="peer block w-full rounded-lg border border-gray-300 pl-10 pr-3 py-2 text-sm text-gray-900 focus:border-green-500 focus:ring-green-500 transition"
                                />
                                <span
                                    class="material-symbols-rounded absolute left-3 top-2.5 text-gray-400"
                                    >business</span
                                >
                            </div>
                            <p
                                class="mt-2 text-sm text-red-600 dark:text-red-500 hidden err-msg"
                            >
                                Pesan error
                            </p>
                        </div>
                    </div>

                    <!-- Alamat -->
                    <h2
                        class="text-2xl font-extrabold text-green-800 flex items-center gap-2 mb-8"
                    >
                        <span class="material-symbols-rounded text-green-600"
                            >home_pin</span
                        >
                        Alamat
                    </h2>
                    <!-- Jalan -->
                    <div class="relative">
                        <label
                            for="jalan"
                            class="block text-sm font-medium text-gray-700"
                            >Jalan</label
                        >
                        <div class="mt-1 relative">
                            <input
                                type="text"
                                id="jalan"
                                name="jalan"
                                maxlength="50"
                                required
                                class="peer block w-full rounded-lg border border-gray-300 pl-10 pr-3 py-2 text-sm text-gray-900 focus:border-green-500 focus:ring-green-500 transition"
                            />
                            <span
                                class="material-symbols-rounded absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
                                >location_on</span
                            >
                        </div>
                        <p
                            class="mt-2 text-sm text-red-600 dark:text-red-500 hidden err-msg"
                        >
                            Pesan error
                        </p>
                    </div>

                    <!-- Kode Pos + WhatsApp -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="relative">
                            <label
                                for="kodepos"
                                class="block text-sm font-medium text-gray-700"
                                >Kode Pos</label
                            >
                            <div class="mt-1 relative">
                                <input
                                    type="text"
                                    id="kodepos"
                                    name="kodepos"
                                    minlength="5"
                                    maxlength="5"
                                    pattern="[0-9]{5}"
                                    required
                                    class="peer block w-full rounded-lg border border-gray-300 pl-10 pr-3 py-2 text-sm text-gray-900 focus:border-green-500 focus:ring-green-500 transition"
                                />
                                <span
                                    class="material-symbols-rounded absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
                                    >markunread_mailbox</span
                                >
                            </div>
                            <p
                                class="mt-2 text-sm text-red-600 dark:text-red-500 hidden err-msg"
                            >
                                Pesan error
                            </p>
                        </div>

                        <div class="relative">
                            <label
                                for="no_rumah"
                                class="block text-sm font-medium text-gray-700"
                                >Nomor Rumah</label
                            >
                            <div class="mt-1 relative">
                                <input
                                    type="text"
                                    id="no_rumah"
                                    maxlength="20"
                                    name="no_rumah"
                                    required
                                    class="peer block w-full rounded-lg border border-gray-300 pl-10 pr-3 py-2 text-sm text-gray-900 focus:border-green-500 focus:ring-green-500 transition"
                                />
                                <span
                                    class="material-symbols-rounded absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
                                    >phone_iphone</span
                                >
                            </div>
                            <p
                                class="mt-2 text-sm text-red-600 dark:text-red-500 hidden err-msg"
                            >
                                Pesan error
                            </p>
                        </div>
                    </div>

                    <!-- RT + RW -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="relative">
                            <label
                                for="rt"
                                class="block text-sm font-medium text-gray-700"
                                >RT</label
                            >
                            <div class="mt-1 relative">
                                <input
                                    type="text"
                                    id="rt"
                                    name="rt"
                                    minlength="4"
                                    maxlength="4"
                                    pattern="[0-9]{4}"
                                    required
                                    class="peer block w-full rounded-lg border border-gray-300 pl-10 pr-3 py-2 text-sm text-gray-900 focus:border-green-500 focus:ring-green-500 transition"
                                />
                                <span
                                    class="material-symbols-rounded absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
                                    >tag</span
                                >
                            </div>
                            <p
                                class="mt-2 text-sm text-red-600 dark:text-red-500 hidden err-msg"
                            >
                                Pesan error
                            </p>
                        </div>

                        <div class="relative">
                            <label
                                for="rw"
                                class="block text-sm font-medium text-gray-700"
                                >RW</label
                            >
                            <div class="mt-1 relative">
                                <input
                                    type="text"
                                    id="rw"
                                    name="rw"
                                    minlength="4"
                                    maxlength="4"
                                    pattern="[0-9]{4}"
                                    required
                                    class="peer block w-full rounded-lg border border-gray-300 pl-10 pr-3 py-2 text-sm text-gray-900 focus:border-green-500 focus:ring-green-500 transition"
                                />
                                <span
                                    class="material-symbols-rounded absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
                                    >tag</span
                                >
                            </div>
                            <p
                                class="mt-2 text-sm text-red-600 dark:text-red-500 hidden err-msg"
                            >
                                Pesan error
                            </p>
                        </div>
                    </div>

                    <!-- Provinsi, Kabupaten, Kecamatan, Kelurahan -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="relative">
                            <label
                                for="provinsi"
                                class="block text-sm font-medium text-gray-700"
                                >Provinsi</label
                            >
                            <div class="mt-1 relative">
                                <select
                                    id="provinsi"
                                    name="provinsi"
                                    required
                                    disabled
                                    class="peer block w-full rounded-lg border border-gray-300 text-gray-900 pl-10 pr-3 py-2 text-sm focus:border-green-500 focus:ring-green-500 transition cursor-pointer disabled:bg-gray-100 disabled:cursor-not-allowed disabled:text-gray-400 disabled:border-gray-200 peer-disabled:text-gray-300"
                                >
                                    <option value="">Pilih provinsi</option>
                                </select>
                                <span
                                    class="material-symbols-rounded absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
                                    >map</span
                                >
                            </div>
                            <p
                                class="mt-2 text-sm text-red-600 dark:text-red-500 hidden err-msg"
                            >
                                Pesan error
                            </p>
                        </div>

                        <div class="relative">
                            <label
                                for="kabupaten"
                                class="block text-sm font-medium text-gray-700"
                                >Kabupaten</label
                            >
                            <div class="mt-1 relative">
                                <select
                                    id="kabupaten"
                                    name="kabupaten"
                                    required
                                    disabled
                                    class="peer block w-full rounded-lg border border-gray-300 text-gray-900 pl-10 pr-3 py-2 text-sm focus:border-green-500 focus:ring-green-500 transition cursor-pointer disabled:bg-gray-100 disabled:cursor-not-allowed disabled:text-gray-400 disabled:border-gray-200 peer-disabled:text-gray-300"
                                >
                                    <option value="">Pilih kabupaten</option>
                                </select>
                                <span
                                    class="material-symbols-rounded absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
                                    >domain</span
                                >
                            </div>
                            <p
                                class="mt-2 text-sm text-red-600 dark:text-red-500 hidden err-msg"
                            >
                                Pesan error
                            </p>
                        </div>

                        <div class="relative">
                            <label
                                for="kecamatan"
                                class="block text-sm font-medium text-gray-700"
                                >Kecamatan</label
                            >
                            <div class="mt-1 relative">
                                <select
                                    id="kecamatan"
                                    name="kecamatan"
                                    required
                                    disabled
                                    class="peer block w-full rounded-lg border border-gray-300 text-gray-900 pl-10 pr-3 py-2 text-sm focus:border-green-500 focus:ring-green-500 transition cursor-pointer disabled:bg-gray-100 disabled:cursor-not-allowed disabled:text-gray-400 disabled:border-gray-200 peer-disabled:text-gray-300"
                                >
                                    <option value="">Pilih kecamatan</option>
                                </select>
                                <span
                                    class="material-symbols-rounded absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
                                    >map</span
                                >
                            </div>
                            <p
                                class="mt-2 text-sm text-red-600 dark:text-red-500 hidden err-msg"
                            >
                                Pesan error
                            </p>
                        </div>

                        <div class="relative">
                            <label
                                for="kelurahan"
                                class="block text-sm font-medium text-gray-700"
                                >Kelurahan</label
                            >
                            <div class="mt-1 relative">
                                <select
                                    id="kelurahan"
                                    name="kelurahan"
                                    required
                                    disabled
                                    class="peer block w-full rounded-lg border border-gray-300 text-gray-900 pl-10 pr-3 py-2 text-sm focus:border-green-500 focus:ring-green-500 transition cursor-pointer disabled:bg-gray-100 disabled:cursor-not-allowed disabled:text-gray-400 disabled:border-gray-200 peer-disabled:text-gray-300"
                                >
                                    <option value="">Pilih kelurahan</option>
                                </select>
                                <span
                                    class="material-symbols-rounded absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
                                    >location_city</span
                                >
                            </div>
                            <p
                                class="mt-2 text-sm text-red-600 dark:text-red-500 hidden err-msg"
                            >
                                Pesan error
                            </p>
                        </div>
                    </div>

                    <!-- Tombol Simpan -->
                    <div class="flex justify-end pt-4">
                        <button
                            type="submit"
                            onclick="kirimData(event)"
                            class="rounded-lg bg-green-600 px-5 py-2 text-sm font-medium text-white hover:bg-green-700 shadow cursor-pointer"
                        >
                            Simpan
                        </button>
                    </div>
                </form>
            </div>
        </section>

        <!-- footer -->
        {% include 'customer/components/footer.html' %}
        <!-- Flowbite JS -->
        <script src="/node_modules/flowbite/dist/flowbite.min.js"></script>
        <script src="{{url_for('static',filename='js/customer/form-auth.js')}}"></script>
        <script>
            // Variable

            const selectProvinsi = document.getElementById("provinsi");
            const selectKabupaten = document.getElementById("kabupaten");
            const selectKecamatan = document.getElementById("kecamatan");
            const selectKelurahan = document.getElementById("kelurahan");

            // Cek jika ada perubahan pada kolom
            function cekInputPengguna() {
                let kolomIsian = document.querySelectorAll(
                    "input[required], select[required]"
                );
                kolomIsian.forEach((element) => {
                    element.addEventListener("input", () => {
                        fieldNormal(element.parentElement.parentElement);
                    });
                });
            }

            // Tampilkan field perusahaan kalau jenis = perusahaan
            const jenisSelect = document.getElementById("jenis");
            const perusahaanField = document.getElementById("field-perusahaan");
            const inpPerusahaan = document.getElementById("perusahaan");
            jenisSelect.addEventListener("change", () => {
                if (jenisSelect.value === "perusahaan") {
                    perusahaanField.classList.remove("hidden");
                    inpPerusahaan.setAttribute("required", "true");
                    inpPerusahaan.removeAttribute("disabled");

                    cekInputPengguna();
                } else {
                    perusahaanField.classList.add("hidden");
                    inpPerusahaan.removeAttribute("required");
                    inpPerusahaan.setAttribute("disabled", true);

                    cekInputPengguna();
                }
            });

            // === FORM SUBMIT ===
            function kirimData(event) {
                event.preventDefault();
                const formBiodata = document.getElementById("form-biodata");
                const regisBio = new FormData(formBiodata);
                regisBio.append("daftarPelanggan", true);

                const formField = document.querySelectorAll(
                    "input[required], select[required]"
                );

                // for (const [name, value] of regisBio) {
                //     console.log(`${name}: ${value}`);
                // }

                let valid = true;
                formField.forEach((kolom) => {
                    if (kolom.value == "") {
                        fieldError(
                            kolom.parentElement.parentElement,
                            "Mohon isi kolom ini"
                        );
                    }
                });

                if (valid) {
                    fetch("/customer/api/data/pelanggan", {
                        method: "POST",
                        body: regisBio,
                    })
                        .then(async (respon) => {
                            const data = await respon.json();
                            if (!respon.ok) {
                                alert(data.message);
                                throw new Error(data.data);
                            }
                            return data;
                        })
                        .then((data) => {
                            alert(data.message);
                        })
                        .catch((error) => {
                            console.error(error);
                        });
                }
            }

            // Fetch wilayah
            function fetchWilayahIndo(apiLink, uid) {
                let link = uid == null ? apiLink : apiLink + "/" + uid;

                return fetch(link, {
                    method: "GET",
                })
                    .then(async (respon) => {
                        const data = await respon.json();
                        if (!respon.ok) {
                            throw new Error(
                                data.message || "Terjadi Kesalahan"
                            );
                        }
                        return data;
                    })
                    .then((data) => {
                        return data.data;
                    })
                    .catch((error) => {
                        console.error("Gagal fetch: ", error);
                    });
            }

            // Opsi provinsi
            fetchWilayahIndo("/api/data/provinsi").then((respon) => {
                respon.forEach((provinsi) => {
                    const opsiProv = new Option(provinsi.name, provinsi.id);
                    selectProvinsi.add(opsiProv);
                });
                selectProvinsi.removeAttribute("disabled");
            });

            // Paksa disable kabupaten
            selectKabupaten.setAttribute("disabled", true);

            // Kabupaten
            selectProvinsi.addEventListener("change", () => {
                const idProv = selectProvinsi.value;

                // Kosongkan dulu pilihannya
                selectKabupaten.options.length = 0;
                const opsiDefault = new Option(
                    "Pilih kabupaten",
                    "",
                    true,
                    true
                );
                selectKabupaten.add(opsiDefault);

                // Fetch kabupaten
                fetchWilayahIndo("/api/data/kabupaten/", idProv).then(
                    (respon) => {
                        respon.forEach((kabupaten) => {
                            const opsiKab = new Option(
                                kabupaten.name,
                                kabupaten.id
                            );
                            selectKabupaten.add(opsiKab);
                        });
                        selectKabupaten.removeAttribute("disabled");
                    }
                );
            });

            // Paksa disable kecamatan
            selectKecamatan.setAttribute("disabled", true);

            // Kecamatan
            selectKabupaten.addEventListener("change", () => {
                const idKab = selectKabupaten.value;

                // Kosongkan dulu pilihannya
                selectKecamatan.options.length = 0;
                const opsiDefault = new Option(
                    "Pilih kecamatan",
                    "",
                    true,
                    true
                );
                selectKecamatan.add(opsiDefault);

                // Fetch kecamatan
                fetchWilayahIndo("/api/data/kecamatan/", idKab).then(
                    (respon) => {
                        respon.forEach((kecamatan) => {
                            const opsiKec = new Option(
                                kecamatan.name,
                                kecamatan.id
                            );
                            selectKecamatan.add(opsiKec);
                        });
                        selectKecamatan.removeAttribute("disabled");
                    }
                );
            });

            // Paksa disable kelurahan
            selectKelurahan.setAttribute("disabled", true);

            // Kelurahan
            selectKecamatan.addEventListener("change", () => {
                const idKec = selectKecamatan.value;

                // Kosongkan dulu pilihannya
                selectKelurahan.options.length = 0;
                const opsiDefault = new Option(
                    "Pilih kelurahan",
                    "",
                    true,
                    true
                );
                selectKelurahan.add(opsiDefault);

                // Fetch kecamatan
                fetchWilayahIndo("/api/data/kelurahan/", idKec).then(
                    (respon) => {
                        respon.forEach((kelurahan) => {
                            const opsiKec = new Option(
                                kelurahan.name,
                                kelurahan.id
                            );
                            selectKelurahan.add(opsiKec);
                        });
                        selectKelurahan.removeAttribute("disabled");
                    }
                );
            });
        </script>
    </body>
</html>
