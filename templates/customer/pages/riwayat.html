<!DOCTYPE html>
<html lang="id">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Histori Pesanan | BCE</title>
        <link
            href="{{url_for('static',filename='dist/output.css')}}"
            rel="stylesheet"
        />
        <!-- Local CSS -->
        <link
            rel="stylesheet"
            href="{{url_for('static',filename='css/customer/style.css')}}"
        />
        <!-- Google icon -->
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
        />
        <!-- Font Awesome -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css"
            integrity="sha512-DxV+EoADOkOygM4IR9yXP8Sb2qwgidEmeqAEmDKIOfPRQZOWbXCzLC6vjbZyy0vPisbH2SyW27+ddLVCN+OMzQ=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        />
        <style>
            section {
                min-height: auto;
            }
            /* Zoom in & out sedang */
            @keyframes zoomPulse {
                0%,
                100% {
                    transform: scale(0.95);
                    opacity: 0.95;
                }
                50% {
                    transform: scale(1.05);
                    opacity: 1;
                }
            }
            .animate-zoom-pulse {
                animation: zoomPulse 2.5s ease-in-out infinite;
            }

            /* Glow neon menyatu logo */
            .logo-glow {
                filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.7))
                    drop-shadow(0 0 20px rgba(255, 255, 255, 0.6))
                    drop-shadow(0 0 40px rgba(144, 238, 144, 0.6));
                animation: glowPulse 1s ease-in-out infinite;
            }

            @keyframes glowPulse {
                0%,
                100% {
                    filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.7))
                        drop-shadow(0 0 16px rgba(255, 255, 255, 0.5))
                        drop-shadow(0 0 32px rgba(144, 238, 144, 0.5));
                }
                50% {
                    filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.9))
                        drop-shadow(0 0 30px rgba(255, 255, 255, 0.8))
                        drop-shadow(0 0 60px rgba(144, 238, 144, 0.7));
                }
            }
        </style>
    </head>
    <body class="bg-white font-sans">
        <!-- Navbar -->
        {% include 'customer/components/navbar.html' %}

        <!-- floating -->
        {% include 'customer/components/floating-sidebar.html' %}

        <!-- Histori Pesanan -->
        <div class="max-w-5xl mx-auto px-4 py-12">
            <!-- Title -->
            <div class="text-center mb-10">
                <h1
                    class="text-4xl md:text-5xl font-extrabold text-green-700 mb-3"
                >
                    Histori Pesanan
                </h1>
                <p class="text-gray-500">
                    Lihat riwayat transaksi Anda dengan mudah
                </p>
            </div>

            <!-- List Pesanan -->
            <div class="space-y-6" id="list-pemesanan-container">
                <!-- Card Pesanan -->
                <div
                    class="bg-white rounded-xl shadow hover:shadow-lg transition p-6 border border-gray-100"
                >
                    <div class="flex justify-between items-center mb-3">
                        <h2 class="text-lg font-semibold text-green-700">
                            BCE-U-240626-001
                        </h2>
                        <span
                            class="px-3 py-1 text-sm rounded-full bg-yellow-100 text-yellow-700 font-medium"
                        >
                            Pending
                        </span>
                    </div>
                    <p class="text-sm text-gray-500">Tanggal: 26 Juni 2024</p>

                    <div
                        class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4 text-sm"
                    >
                        <div>
                            <p class="font-medium text-gray-700">Penerima</p>
                            <p class="text-gray-600">Rina Marlina</p>
                        </div>
                        <div>
                            <p class="font-medium text-gray-700">Alamat</p>
                            <p class="text-gray-600">
                                Jl. Melati No. 1, Jakarta
                            </p>
                        </div>
                        <div>
                            <p class="font-medium text-gray-700">Jenis Kargo</p>
                            <p class="text-gray-600">Udara</p>
                        </div>
                        <div>
                            <p class="font-medium text-gray-700">Berat</p>
                            <p class="text-gray-600">5 Kg</p>
                        </div>
                        <div>
                            <p class="font-medium text-gray-700">Harga</p>
                            <p class="text-green-600 font-bold">Rp 250.000</p>
                        </div>
                    </div>

                    <!-- Tombol Detail -->
                    <div class="mt-5 flex justify-end">
                        <button
                            onclick="openModal('modal1')"
                            class="px-5 py-2 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 shadow transition cursor-pointer"
                        >
                            Lihat Detail
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal -->
        <div
            id="modal1"
            class="hidden fixed inset-0 bg-black/60 flex items-center justify-center z-50"
        >
            <div
                class="bg-white rounded-xl shadow-lg w-full max-w-lg p-6 relative animate-fade-in"
            >
                <button
                    onclick="closeModal('modal1')"
                    class="absolute top-3 right-3 text-gray-500 hover:text-red-600 text-lg"
                >
                    âœ•
                </button>
                <h2 class="text-xl font-bold mb-4 text-green-700">
                    Detail Pesanan
                </h2>
                <div class="space-y-2 text-sm text-gray-700">
                    <p>
                        <span class="font-semibold">Kode Pesanan:</span>
                        <span id="kode-pemesanan">BCE-U-240626-001</span>
                    </p>
                    <p>
                        <span class="font-semibold">Tanggal:</span>
                        <span id="tanggal-pemesanan">26 Juni 2024</span>
                    </p>
                    <p>
                        <span class="font-semibold">Nama Pengirim:</span>
                        <span id="nama-pengirim">Andi Saputra</span>
                    </p>
                    <p>
                        <span class="font-semibold">Alamat Pengirim:</span>
                        <span id="alamat-pengirim">
                            Jl. Melati No. 1, Jakarta
                        </span>
                    </p>
                    <p>
                        <span class="font-semibold">Nama Penerima:</span>
                        <span id="nama-penerima"> Rina Marlina </span>
                    </p>
                    <p>
                        <span class="font-semibold">Alamat Penerima:</span>
                        <span id="alamat-penerima">
                            Jl. Kamboja No. 2, Bandung
                        </span>
                    </p>
                    <p>
                        <span class="font-semibold">No. HP Pengirim:</span>
                        <span id="no-pengirim"> 081234567890 </span>
                    </p>
                    <p>
                        <span class="font-semibold">No. HP Penerima:</span>
                        <span id="no-penerima"> 082345678901 </span>
                    </p>
                    <p>
                        <span class="font-semibold">Jenis Kargo:</span>
                        <span id="jenis">Udara</span>
                    </p>
                    <p>
                        <span class="font-semibold">Berat:</span>
                        <span id="berat">5 Kg</span>
                    </p>
                    <p>
                        <span class="font-semibold">Total Harga:</span>
                        <span id="harga"> Rp 250.000 </span>
                    </p>
                    <p>
                        <span class="font-semibold">Status:</span>
                        <span id="status"> Pending </span>
                    </p>
                </div>
                <div class="mt-6 flex justify-end">
                    <button
                        onclick="closeModal('modal1')"
                        class="px-5 py-2 bg-gray-400 text-white rounded-lg hover:bg-gray-500 transition cursor-pointer"
                    >
                        Tutup
                    </button>
                </div>
            </div>
        </div>
        <!-- Overlay Transition -->
        <div
            id="page-transition"
            class="fixed inset-0 z-[9999] flex items-center justify-center bg-green-600 transform translate-x-full transition-transform duration-700 ease-in-out"
        >
            <!-- Logo BCE -->
            <div class="relative flex items-center justify-center">
                <!-- Logo + efek glow -->
                <img
                    src="/static/images/logo_transparant.png"
                    alt="BCE Logo"
                    class="relative w-24 h-24 animate-zoom-pulse logo-glow"
                    id="bce-logo"
                />
            </div>
        </div>

        <!-- footer -->
        {% include 'customer/components/footer.html' %}
        <!-- Flowbite JS -->
        <script src="/node_modules/flowbite/dist/flowbite.min.js"></script>
        <script>
            const transitionEl = document.getElementById("page-transition");
            const links = document.querySelectorAll(".page-link");
            const listPemesananContainer = document.querySelector(
                "#list-pemesanan-container"
            );

            let dataPemesanan = [];
            let dataBarangPesanan = {};

            links.forEach((link) => {
                link.addEventListener("click", function (e) {
                    e.preventDefault();
                    const target = this.getAttribute("href");

                    // Tirai menutup
                    transitionEl.classList.remove("translate-x-full");
                    transitionEl.classList.add("translate-x-0");

                    // Redirect setelah animasi selesai
                    setTimeout(() => {
                        window.location.href = target;
                    }, 1200);
                });
            });

            // Tirai terbuka saat pertama load halaman
            window.addEventListener("load", () => {
                setTimeout(() => {
                    transitionEl.classList.add("translate-x-full");
                    transitionEl.classList.remove("translate-x-0");
                }, 500);
            });

            // Fungsi Modal (Lihat detail)
            function openModal(id, kodePemesanan) {
                // fetch
                fetch(`/customer/api/data/barang/${kodePemesanan}`, {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json",
                    },
                })
                    .then(async (respon) => {
                        const data = await respon.json();
                        if (!respon.ok) {
                            throw new Error(data.message);
                        }
                        return data;
                    })
                    .then((data) => {
                        data = data.data;
                        dataBarangPesanan = data;
                        if (data.length === 0) {
                            // Kalo data barang tidak tersedia
                        } else {
                            document.getElementById(
                                "kode-pemesanan"
                            ).textContent = dataPemesanan[0].kode_pemesanan;
                            document.getElementById(
                                "tanggal-pemesanan"
                            ).textContent = dataPemesanan[0].tanggal_pemesanan;
                            document.getElementById(
                                "nama-pengirim"
                            ).textContent = dataPemesanan[0].nama_pengirim;
                            document.getElementById(
                                "alamat-pengirim"
                            ).textContent = dataPemesanan[0].alamat_pengirim;
                            document.getElementById(
                                "nama-penerima"
                            ).textContent = dataPemesanan[0].nama_penerima;
                            document.getElementById(
                                "alamat-penerima"
                            ).textContent = dataPemesanan[0].alamat_penerima;
                            document.getElementById("no-pengirim").textContent =
                                dataPemesanan[0].no_pengirim;
                            document.getElementById("no-penerima").textContent =
                                dataPemesanan[0].no_penerima;
                            document.getElementById("jenis").textContent =
                                dataPemesanan[0].jenis_kargo;
                            document.getElementById("berat").textContent =
                                dataBarangPesanan.berat_kg;
                            document.getElementById("harga").textContent =
                                dataPemesanan[0].harga_total;
                            document.getElementById("status").textContent =
                                dataPemesanan[0].status;
                        }
                    })
                    .catch((error) => {
                        console.error(error);
                    });

                // modal
                document.getElementById(id).classList.remove("hidden");

                const modal = document.getElementById(id);
                modal.classList.remove("hidden");

                const content = modal.querySelector("div");
                content.classList.add("modal-enter");
                requestAnimationFrame(() => {
                    content.classList.add("modal-enter-active");
                    content.classList.remove("modal-enter");
                });
            }

            function closeModal(id) {
                document.getElementById(id).classList.add("hidden");
            }

            //
            function muatDataPemesanan() {
                fetch("/customer/api/data/riwayat", {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json",
                    },
                })
                    .then(async (respon) => {
                        const data = await respon.json();
                        if (!respon.ok) {
                            throw new Error(data.message);
                        }
                        return data;
                    })
                    .then((data) => {
                        data = data.data;
                        if (data.length === 0) {
                            listPemesananContainer.innerHTML =
                                "<p>Histori pemesanan tidak tersedia</p>";
                        } else {
                            dataPemesanan = data;
                            let listPemesanan = "";

                            dataPemesanan.forEach((pemesanan) => {
                                listPemesanan += `
                                    <div
                                        class="bg-white rounded-xl shadow hover:shadow-lg transition p-6 border border-gray-100"
                                    >
                                        <div class="flex justify-between items-center mb-3">
                                            <h2 class="text-lg font-semibold text-green-700">
                                                ${pemesanan.kode_pemesanan}
                                            </h2>
                                            <span
                                                class="px-3 py-1 text-sm rounded-full bg-yellow-100 text-yellow-700 font-medium"
                                            >
                                                ${pemesanan.status}
                                            </span>
                                        </div>
                                        <p class="text-sm text-gray-500">Tanggal: ${pemesanan.tanggal_pemesanan}</p>
                                    
                                        <div
                                            class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4 text-sm"
                                        >
                                            <div>
                                                <p class="font-medium text-gray-700">Penerima</p>
                                                <p class="text-gray-600">${pemesanan.nama_penerima}</p>
                                            </div>
                                            <div>
                                                <p class="font-medium text-gray-700">Alamat</p>
                                                <p class="text-gray-600">
                                                    ${pemesanan.alamat_penerima}
                                                </p>
                                            </div>
                                            <div>
                                                <p class="font-medium text-gray-700">Jenis Kargo</p>
                                                <p class="text-gray-600">${pemesanan.jenis_kargo}</p>
                                            </div>
                                            <div>
                                                <p class="font-medium text-gray-700">Harga</p>
                                                <p class="text-green-600 font-bold">${pemesanan.harga_total}</p>
                                            </div>
                                        </div>
                                    
                                        <!-- Tombol Detail -->
                                        <div class="mt-5 flex justify-end">
                                            <button
                                                onclick="openModal('modal1', '${pemesanan.kode_pemesanan}')"
                                                class="px-5 py-2 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 shadow transition cursor-pointer"
                                            >
                                                Lihat Detail
                                            </button>
                                        </div>
                                    </div>
                                `;

                                listPemesananContainer.innerHTML =
                                    listPemesanan;
                            });
                        }
                    })
                    .catch((error) => {
                        console.error(error);
                    });
            }

            muatDataPemesanan();
        </script>
    </body>
</html>
